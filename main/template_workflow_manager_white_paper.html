

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>White Paper: template_workflow_manager Module &mdash; DNACenterAnsibleActions  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="_static/ansible-basic-sphinx-ext.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
      <script src="_static/doctools.js?v=888ff710"></script>
      <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            DNACenterAnsibleActions
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="plugins/index.html">Cisco.Dnac</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">DNACenterAnsibleActions</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">White Paper: <code class="docutils literal notranslate"><span class="pre">template_workflow_manager</span></code> Module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/template_workflow_manager_white_paper.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="white-paper-template-workflow-manager-module">
<h1>White Paper: <code class="docutils literal notranslate"><span class="pre">template_workflow_manager</span></code> Module<a class="headerlink" href="#white-paper-template-workflow-manager-module" title="Permalink to this heading"></a></h1>
<section id="executive-summary">
<h2>Executive Summary<a class="headerlink" href="#executive-summary" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">cisco.dnac.template_workflow_manager</span></code> Ansible module provides an orchestration layer for Cisco Catalyst Center template lifecycle management. It consolidates multiple operational concerns into a single workflow entry point:</p>
<ul class="simple">
<li><p>Project lifecycle (create, update, delete)</p></li>
<li><p>Configuration template lifecycle (create, update, commit, delete)</p></li>
<li><p>Template import/export operations</p></li>
<li><p>Template deployment to devices</p></li>
<li><p>Optional post-change verification (<code class="docutils literal notranslate"><span class="pre">config_verify</span></code>)</p></li>
<li><p>Network profile attach/detach workflows for CLI templates (version-gated)</p></li>
</ul>
<p>This module is designed for day-2 operations where consistency, idempotency, and controlled task polling are required across large template estates.</p>
</section>
<section id="problem-statement">
<h2>Problem Statement<a class="headerlink" href="#problem-statement" title="Permalink to this heading"></a></h2>
<p>Template operations in Catalyst Center are not a single API call in practice. Common enterprise workflows require chained operations:</p>
<ul class="simple">
<li><p>Ensure a project exists</p></li>
<li><p>Create or update a template</p></li>
<li><p>Commit/version it</p></li>
<li><p>Optionally bind profiles</p></li>
<li><p>Deploy with device- or site-scoped targeting</p></li>
<li><p>Verify final state</p></li>
</ul>
<p>Without orchestration, each step becomes fragile and hard to standardize in playbooks. The <code class="docutils literal notranslate"><span class="pre">template_workflow_manager</span></code> module addresses this by composing these steps into deterministic state-driven execution.</p>
</section>
<section id="module-scope">
<h2>Module Scope<a class="headerlink" href="#module-scope" title="Permalink to this heading"></a></h2>
<p>Primary source implementation: <code class="docutils literal notranslate"><span class="pre">plugins/modules/template_workflow_manager.py</span></code></p>
<p>High-level states:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">state:</span> <span class="pre">merged</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">state:</span> <span class="pre">deleted</span></code></p></li>
</ul>
<p>Primary top-level config domains:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">projects</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">configuration_templates</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">import</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">export</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">deploy_template</span></code></p></li>
</ul>
</section>
<section id="architecture-overview">
<h2>Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permalink to this heading"></a></h2>
<p>The module is implemented as class <code class="docutils literal notranslate"><span class="pre">Template(NetworkProfileFunctions)</span></code> and follows a predictable execution pipeline:</p>
<ol class="simple">
<li><p>Validate input schema and semantic constraints</p></li>
<li><p>Build <code class="docutils literal notranslate"><span class="pre">have</span></code> (current Catalyst Center state)</p></li>
<li><p>Build <code class="docutils literal notranslate"><span class="pre">want</span></code> (desired state from playbook)</p></li>
<li><p>Execute state handler (<code class="docutils literal notranslate"><span class="pre">get_diff_merged</span></code> or <code class="docutils literal notranslate"><span class="pre">get_diff_deleted</span></code>)</p></li>
<li><p>Optionally verify (<code class="docutils literal notranslate"><span class="pre">verify_diff_merged</span></code> / <code class="docutils literal notranslate"><span class="pre">verify_diff_deleted</span></code>)</p></li>
</ol>
<p>Core internal state containers:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">self.have</span></code>: discovered current state</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.want</span></code>: desired normalized state</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.result</span></code>: structured operation output</p></li>
</ul>
</section>
<section id="version-and-feature-gating">
<h2>Version and Feature Gating<a class="headerlink" href="#version-and-feature-gating" title="Permalink to this heading"></a></h2>
<p>The module enforces runtime compatibility:</p>
<ul class="simple">
<li><p>Fails if Catalyst Center version is below <code class="docutils literal notranslate"><span class="pre">2.3.7.6</span></code> (entry guard in <code class="docutils literal notranslate"><span class="pre">main()</span></code>)</p></li>
<li><p>Profile assignment/detachment flow requires Catalyst Center <code class="docutils literal notranslate"><span class="pre">&gt;=</span> <span class="pre">3.1.3.0</span></code></p></li>
</ul>
<p>Important implementation note:</p>
<ul class="simple">
<li><p>A legacy delete branch exists for <code class="docutils literal notranslate"><span class="pre">&lt;=</span> <span class="pre">2.3.5.3</span></code>, but this path is practically unreachable under the current minimum-version gate (<code class="docutils literal notranslate"><span class="pre">2.3.7.6</span></code>).</p></li>
</ul>
</section>
<section id="input-normalization-and-validation">
<h2>Input Normalization and Validation<a class="headerlink" href="#input-normalization-and-validation" title="Permalink to this heading"></a></h2>
<p>Validation is performed in two layers:</p>
<ol class="simple">
<li><p>Structural validation via <code class="docutils literal notranslate"><span class="pre">validate_list_of_dicts</span></code> against <code class="docutils literal notranslate"><span class="pre">temp_spec</span></code></p></li>
<li><p>Semantic validation via <code class="docutils literal notranslate"><span class="pre">input_data_validation()</span></code></p></li>
</ol>
<p>Key validations include:</p>
<ul class="simple">
<li><p>Required project/template identifiers in relevant flows</p></li>
<li><p>Enforced enums (language, product family, software type, etc.)</p></li>
<li><p>Profile feature availability based on Catalyst Center version</p></li>
<li><p>File path existence and extension checks for template content files (<code class="docutils literal notranslate"><span class="pre">.j2</span></code>, <code class="docutils literal notranslate"><span class="pre">.txt</span></code>)</p></li>
<li><p>Deploy-time requirement for template parameters</p></li>
</ul>
</section>
<section id="merged-state-behavior">
<h2><code class="docutils literal notranslate"><span class="pre">merged</span></code> State Behavior<a class="headerlink" href="#merged-state-behavior" title="Permalink to this heading"></a></h2>
<section id="project-management-projects">
<h3>1) Project Management (<code class="docutils literal notranslate"><span class="pre">projects</span></code>)<a class="headerlink" href="#project-management-projects" title="Permalink to this heading"></a></h3>
<p>For each project entry:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">new_name</span></code> exists: update flow</p></li>
<li><p>Else: create flow</p></li>
</ul>
<p>Idempotency logic compares requested and existing project keys; if no effective delta exists, the module reports no change.</p>
</section>
<section id="template-management-configuration-templates">
<h3>2) Template Management (<code class="docutils literal notranslate"><span class="pre">configuration_templates</span></code>)<a class="headerlink" href="#template-management-configuration-templates" title="Permalink to this heading"></a></h3>
<p>Template flow includes:</p>
<ul class="simple">
<li><p>Project existence resolution</p></li>
<li><p>Template existence and commit-pending status discovery</p></li>
<li><p>Create or update decision</p></li>
<li><p>Optional rename via <code class="docutils literal notranslate"><span class="pre">new_template_name</span></code> with duplicate-name check</p></li>
<li><p>Conditional commit (<code class="docutils literal notranslate"><span class="pre">commit:</span> <span class="pre">true</span></code> by default)</p></li>
</ul>
<p>Update detection relies on deep comparison of key fields plus dedicated handling of <code class="docutils literal notranslate"><span class="pre">containingTemplates</span></code>.</p>
</section>
<section id="profile-assignment-cli-template-network-profile">
<h3>3) Profile Assignment (CLI Template + Network Profile)<a class="headerlink" href="#profile-assignment-cli-template-network-profile" title="Permalink to this heading"></a></h3>
<p>When <code class="docutils literal notranslate"><span class="pre">profile_names</span></code> are provided and platform version allows:</p>
<ul class="simple">
<li><p>Profiles are retrieved with pagination by mapped profile category</p></li>
<li><p>Each profile is validated for existence</p></li>
<li><p>Assignment status is checked per profile</p></li>
<li><p>Only non-assigned profiles are attached (idempotent behavior)</p></li>
</ul>
</section>
<section id="import-operations-import">
<h3>4) Import Operations (<code class="docutils literal notranslate"><span class="pre">import</span></code>)<a class="headerlink" href="#import-operations-import" title="Permalink to this heading"></a></h3>
<p>Project import:</p>
<ul class="simple">
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">payload</span></code> or <code class="docutils literal notranslate"><span class="pre">project_file</span></code> (JSON)</p></li>
<li><p>Skips already existing projects when payload-driven</p></li>
</ul>
<p>Template import:</p>
<ul class="simple">
<li><p>Requires <code class="docutils literal notranslate"><span class="pre">project_name</span></code> to exist</p></li>
<li><p>Accepts <code class="docutils literal notranslate"><span class="pre">payload</span></code> or <code class="docutils literal notranslate"><span class="pre">template_file</span></code> (JSON)</p></li>
<li><p>Enforces alignment between global import <code class="docutils literal notranslate"><span class="pre">project_name</span></code> and template payload project</p></li>
</ul>
</section>
<section id="export-operations-export">
<h3>5) Export Operations (<code class="docutils literal notranslate"><span class="pre">export</span></code>)<a class="headerlink" href="#export-operations-export" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Project export by project name list</p></li>
<li><p>Template export by resolving template IDs from <code class="docutils literal notranslate"><span class="pre">(project_name,</span> <span class="pre">template_name)</span></code> tuples</p></li>
</ul>
</section>
<section id="deployment-deploy-template">
<h3>6) Deployment (<code class="docutils literal notranslate"><span class="pre">deploy_template</span></code>)<a class="headerlink" href="#deployment-deploy-template" title="Permalink to this heading"></a></h3>
<p>Device targeting supports two modes:</p>
<ul class="simple">
<li><p>Direct device selectors (<code class="docutils literal notranslate"><span class="pre">device_details</span></code>): priority <code class="docutils literal notranslate"><span class="pre">device_ips</span> <span class="pre">&gt;</span> <span class="pre">device_hostnames</span> <span class="pre">&gt;</span> <span class="pre">serial_numbers</span> <span class="pre">&gt;</span> <span class="pre">mac_addresses</span></code></p></li>
<li><p>Site-scoped selectors (<code class="docutils literal notranslate"><span class="pre">site_provisioning_details</span></code>) with optional filters:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">device_family</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">device_role</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">device_tag</span></code> (intersection with site-assigned inventory)</p></li>
</ul>
</li>
</ul>
<p>Deployment payload composition includes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">forcePushTemplate</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">isComposite</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">copyingConfig</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">targetInfo[]</span></code> with template parameter map</p></li>
<li><p>Optional <code class="docutils literal notranslate"><span class="pre">resourceParams</span></code> supporting runtime-resolved types:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">MANAGED_DEVICE_UUID</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MANAGED_DEVICE_IP</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MANAGED_DEVICE_HOSTNAME</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SITE_UUID</span></code></p></li>
</ul>
</li>
</ul>
<p>The module polls task state and deployment state with timeout/poll-interval controls.</p>
</section>
</section>
<section id="deleted-state-behavior">
<h2><code class="docutils literal notranslate"><span class="pre">deleted</span></code> State Behavior<a class="headerlink" href="#deleted-state-behavior" title="Permalink to this heading"></a></h2>
<p>Delete flow supports:</p>
<ul class="simple">
<li><p>Template deletion by <code class="docutils literal notranslate"><span class="pre">template_name</span></code></p></li>
<li><p>Project deletion when template name is not provided and project is deletable</p></li>
<li><p>Batch project deletion through <code class="docutils literal notranslate"><span class="pre">projects</span></code> list</p></li>
</ul>
<p>For profile-capable environments (<code class="docutils literal notranslate"><span class="pre">&gt;=</span> <span class="pre">3.1.3.0</span></code>), associated profiles are detached before delete operations when applicable.</p>
<p>Explicit constraint:</p>
<ul class="simple">
<li><p>Deployment-based rollback/removal is not supported in deleted state.</p></li>
</ul>
</section>
<section id="idempotency-strategy">
<h2>Idempotency Strategy<a class="headerlink" href="#idempotency-strategy" title="Permalink to this heading"></a></h2>
<p>Idempotency is implemented through:</p>
<ul class="simple">
<li><p>Explicit <code class="docutils literal notranslate"><span class="pre">have</span></code>/<code class="docutils literal notranslate"><span class="pre">want</span></code> modeling</p></li>
<li><p>Field-level equality checks (<code class="docutils literal notranslate"><span class="pre">dnac_compare_equality</span></code>)</p></li>
<li><p>Short-circuit behavior when no change is required</p></li>
<li><p>Commit checks for uncommitted templates</p></li>
<li><p>Deployment short-circuit when backend reports &quot;already deployed with same params&quot;</p></li>
</ul>
</section>
<section id="observability-and-operational-safety">
<h2>Observability and Operational Safety<a class="headerlink" href="#observability-and-operational-safety" title="Permalink to this heading"></a></h2>
<p>The module provides robust operational telemetry via structured logs and task polling:</p>
<ul class="simple">
<li><p>Uses task ID retrieval and polling for asynchronous Catalyst Center operations</p></li>
<li><p>Applies configurable timeout and poll interval:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">dnac_api_task_timeout</span></code> (default <code class="docutils literal notranslate"><span class="pre">1200</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnac_task_poll_interval</span></code> (default <code class="docutils literal notranslate"><span class="pre">2</span></code>)</p></li>
</ul>
</li>
<li><p>Surfaces explicit messages for failure reason, missing resources, and invalid input</p></li>
</ul>
<p>Result messaging aggregates outcomes across projects, templates, commits, profile assignment/detachment, import/export, and deploy.</p>
</section>
<section id="file-based-template-content">
<h2>File-Based Template Content<a class="headerlink" href="#file-based-template-content" title="Permalink to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">template_content_file_path</span></code> behavior:</p>
<ul class="simple">
<li><p>Accepted extensions: <code class="docutils literal notranslate"><span class="pre">.j2</span></code>, <code class="docutils literal notranslate"><span class="pre">.txt</span></code></p></li>
<li><p>File content source has priority over inline <code class="docutils literal notranslate"><span class="pre">template_content</span></code></p></li>
<li><p>Missing file or invalid extension fails fast</p></li>
</ul>
<p>Implementation behavior currently reads file content directly and submits it in API payload. Operators should treat template rendering expectations according to their pipeline and Catalyst Center behavior.</p>
</section>
<section id="test-coverage-summary">
<h2>Test Coverage Summary<a class="headerlink" href="#test-coverage-summary" title="Permalink to this heading"></a></h2>
<p>Primary unit test file: <code class="docutils literal notranslate"><span class="pre">tests/unit/modules/dnac/test_template_workflow_manager.py</span></code></p>
<p>Covered flows include:</p>
<ul class="simple">
<li><p>Create template</p></li>
<li><p>Update template</p></li>
<li><p>Delete template</p></li>
<li><p>Export project/template</p></li>
<li><p>Import project/template</p></li>
<li><p>Project create/update/delete sequences</p></li>
<li><p>File-path-driven template content cases:</p>
<ul>
<li><p>valid file path</p></li>
<li><p>invalid extension</p></li>
<li><p>missing file</p></li>
</ul>
</li>
</ul>
<p>Fixture-driven API response simulation is provided in <code class="docutils literal notranslate"><span class="pre">tests/unit/modules/dnac/fixtures/template_workflow_manager.json</span></code>.</p>
</section>
<section id="recommended-usage-patterns">
<h2>Recommended Usage Patterns<a class="headerlink" href="#recommended-usage-patterns" title="Permalink to this heading"></a></h2>
<ol class="simple">
<li><p>Use single-responsibility playbook tasks when possible (project lifecycle separate from deployment lifecycle) for easier rollback and observability.</p></li>
<li><p>Enable <code class="docutils literal notranslate"><span class="pre">config_verify:</span> <span class="pre">true</span></code> in production pipelines.</p></li>
<li><p>Pin and validate Catalyst Center version before profile operations.</p></li>
<li><p>Prefer explicit device targeting for change windows; use site/tag scoping for broad operational policies.</p></li>
<li><p>Keep template parameter naming consistent and treat runtime <code class="docutils literal notranslate"><span class="pre">resource_parameters</span></code> as deployment-time bindings.</p></li>
</ol>
</section>
<section id="known-constraints-and-considerations">
<h2>Known Constraints and Considerations<a class="headerlink" href="#known-constraints-and-considerations" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Deleted state does not support removing device configuration through deployment semantics.</p></li>
<li><p>Profile assignment/detachment is version-gated.</p></li>
<li><p>Template import requires existing project context.</p></li>
<li><p>Deployment success interpretation depends on backend task/deployment progress payload content.</p></li>
</ul>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">template_workflow_manager</span></code> is a high-value orchestration module for Catalyst Center template operations, especially in enterprise environments where repeatability and operational safety matter. Its state-driven design, version checks, asynchronous task monitoring, and idempotent behavior make it suitable for CI/CD pipelines and controlled network automation at scale.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2021 Cisco Systems.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>